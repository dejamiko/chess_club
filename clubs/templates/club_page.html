{% extends 'base_content.html' %}
{% block content %}

<div class="container">
  <div class="row">
    <div class="col-12">
      <h1 style="margin-bottom: 20px;">{{ club.name }}</h1>

      <div class="container">
        <div class="col col-md-auto">

          <ul>
            <li><b>Owner:</b><br />
              <img style="border-radius: 8px;" src="{{ club.owner.mini_gravatar }}"
                       alt="{{ club.owner.first_name }} {{ club.owner.last_name }}'s profile picture">
              {{ club.owner.first_name }} {{ club.owner.last_name }}</li>
            <li><b>Description:</b> {{ club.description }}</li>
            <li><b>Location:</b> {{ club.name }}</li>
          </ul>

          <script src="https://code.jquery.com/jquery-3.6.0.js"
                  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
                  crossorigin="anonymous">
          </script>

          <form id="apply_button">
              {% csrf_token %}

              {% if curr_user not in club.get_all_users %}

                  <input type="hidden" id="hiddenstuff" name="obj"
                         value="{{ club.name }}"/>
                  <input class="btn btn-outline-secondary btn-sm" type="submit" onClick="window.location.reload();" id="submitbutton" value="Apply"
                          {% if curr_user in club.get_all_applicants %}
                         disabled {% endif %}/>
              {% endif %}

          </form>

          <br /><br />
          {% if curr_user in club.get_all_applicants %}
            <p>You have applied to this club</p>

          {% elif curr_user in club.get_members %}
            <p>You are a member of this club</p>

          {% elif curr_user in club.get_officers %}
            <p>You are an officer of this club</p>

          {% elif curr_user in club.get %}
            <p>You are a member of this club</p>

          {% elif curr_user == club.get_owner %}
            <p>You are the owner of this club</p>
          {% endif %}

        </div>

        <div class="col col-md-auto">
          <h2 style="margin-bottom: 20px;">Tournaments</h2>
            <!-- Add a table of tournaments -->
            <table id='tournament_table' class='table table-hover'>
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Description</th>
                  <th scope="col">Participants</th>
                <tr>
              </thead>

              <tbody>
                {% for tournament in club.get_all_tournaments %}
                  <tr>
                    <td>{{ tournament.name }}</td>
                    <td>{{ tournament.description }}</td>
                    <td>{{ tournament.get_number_of_participants }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>

        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(document).on('submit', 'form', function (e) {
        var curr_form = $(this);
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: '',
            data: {
                name: curr_form.find('#hiddenstuff').val(),
                csrfmiddlewaretoken: $(`input[name=csrfmiddlewaretoken]`).val(),
            },
            success: function () {
                curr_form.find('#submitbutton').attr('disabled', true);
            }
        })
    })
</script>

{% endblock %}
